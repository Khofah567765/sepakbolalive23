<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8">
  <title>TV Streaming Indonesia</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <!-- Tailwind for styling -->
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    .channel-active {
      background: rgba(34, 197, 94, 0.10);
      border-color: #22c55e;
      color: #22c55e;
    }
    .channel-offline {
      background: rgba(239, 68, 68, 0.08);
      border-color: #ef4444;
      color: #ef4444;
    }
    .category-selected {
      border-bottom: 2px solid #0ea5e9;
      color: #0ea5e9;
    }
    .category-button:hover {
      color: #0369a1;
    }
    .logo-fallback {
      background: linear-gradient(135deg, #e2e8f0 0%, #f8fafc 100%);
      display: flex;
      align-items: center;
      justify-content: center;
      color: #64748b;
      font-size: 1.6rem;
      font-weight: bold;
      width: 64px;
      height: 64px;
      border-radius: 12px;
    }
  </style>
</head>
<body class="bg-gray-100 min-h-screen flex flex-col">
  <!-- Header -->
  <header class="bg-white shadow sticky top-0 z-30">
    <div class="container mx-auto px-4 py-5 flex items-center justify-between">
      <div class="flex items-center gap-3">
        <div class="rounded-lg overflow-hidden shadow">
          <img 
            src="https://storage.googleapis.com/workspace-0f70711f-8b4e-4d94-86f1-2a93ccde5887/image/caa1ef10-2147-4f51-8947-8b39a522257e.png" 
            alt="Logo website TV Streaming, gaya flat, biru muda, dengan teks TV, latar belakang putih, desain sederhana" 
            class="w-12 h-12"
            onerror="this.style.display='none';this.parentNode.insertAdjacentHTML('beforeend','<span class=\'logo-fallback\'>TV</span>')"
          />
        </div>
        <span class="font-bold text-2xl text-blue-600">TV Streaming ID</span>
      </div>
      <nav>
        <span class="text-sm text-gray-500">Siaran TV Indonesia & Internasional</span>
      </nav>
    </div>
  </header>

  <!-- Main Content -->
  <main class="flex-1 container mx-auto px-3 py-6 flex flex-col lg:flex-row gap-8">
    <!-- Player Section -->
    <section class="flex-1 flex flex-col items-center">
      <div class="bg-black rounded-xl w-full aspect-video flex items-center justify-center shadow mb-3 relative">
        <video id="tv-player" autoplay playsinline poster="https://storage.googleapis.com/workspace-0f70711f-8b4e-4d94-86f1-2a93ccde5887/image/12929421-b8b3-4f22-b22d-c1916c31e301.png" class="w-full h-full object-cover rounded-xl"></video>
        <div id="player-loading" class="absolute inset-0 flex items-center justify-center" style="display:none;">
          <div class="border-4 border-blue-400 border-t-transparent animate-spin rounded-full w-12 h-12"></div>
        </div>
      </div>
      <!-- Player Controls -->
      <div class="flex flex-col gap-2 mt-2 w-full justify-start sm:flex-row">
        <button id="btn-fs" class="bg-white/80 border text-gray-800 px-4 py-2 rounded shadow hover:bg-blue-100 transition font-semibold text-sm w-full sm:w-auto">Full Layar</button>
        <button id="btn-mute" class="bg-white/80 border text-gray-800 px-4 py-2 rounded shadow hover:bg-blue-100 transition font-semibold text-sm w-full sm:w-auto">Unmute</button>
        <select id="btn-res" class="bg-white/80 border text-gray-800 px-4 py-2 rounded shadow hover:bg-blue-100 transition font-semibold text-sm hidden w-full sm:w-auto"></select>
      </div>
      <div id="current-channel-info" class="mt-2 text-center">
        <h2 class="text-xl font-semibold text-gray-800" id="currentChannelName">Pilih channel TV untuk mulai streaming</h2>
        <span class="inline-block mt-1 px-2 py-1 text-xs rounded-full bg-gray-100 text-gray-500" id="currentChannelStatus"></span>
      </div>
    </section>

    <!-- Channel List Section -->
    <aside class="w-full lg:w-96 bg-white rounded-xl shadow flex flex-col p-4 space-y-4">
      <!-- Categories -->
      <div id="category-filter" class="flex flex-wrap gap-2 border-b pb-2 justify-start items-center">
        <!-- Category buttons inserted here -->
      </div>

      <!-- Channel List -->
      <div id="channel-list" class="space-y-3 max-h-[70vh] overflow-y-auto pt-1">
        <!-- Channel items inserted here by JS -->
      </div>
    </aside>
  </main>

  <!-- Footer -->
  <footer class="text-center text-xs text-gray-400 py-5">
    Â© 2024 TV Streaming ID. All rights reserved.
  </footer>

  <script>
    // Dummy TV channel data
    const CHANNELS = [
      {
        name: "TVRI Nasional",
        stream: [
          {label:"AUTO",url:"https://test-streams.mux.dev/x36xhzz/x36xhzz.m3u8"},
          {label:"360p",url:"https://bitdash-a.akamaihd.net/content/sintel/hls/playlist.m3u8"}
        ],
        online: true,
        category: "Indonesia"
      },
      {
        name: "Example MultiRes",
        stream: [
          {label:"AUTO",url:"https://bitmovin-a.akamaihd.net/content/sintel/hls/playlist.m3u8"},
          {label:"480p",url:"https://test-streams.mux.dev/dai-discontinuity-daterange/will_play.m3u8"}
        ],
        online: true,
        category: "International"
      },
      {
        name: "Big Buck Bunny",
        stream: [
          {label:"AUTO",url:"https://test-streams.mux.dev/bbb_720p/bbb_720p.m3u8"},
          {label:"720p",url:"https://test-streams.mux.dev/bbb_720p/bbb_720p.m3u8"},
          {label:"480p",url:"https://test-streams.mux.dev/bbb_480p/bbb_480p.m3u8"}
        ],
        online: true,
        category: "Film"
      },
      {
        name: "RCTI",
        stream: [
          {label:"AUTO",url:"https://bitdash-a.akamaihd.net/content/sintel/hls/playlist.m3u8"}
        ],
        online: true,
        category: "Indonesia"
      },
      {
        name: "NASA TV",
        stream: [
          {label:"AUTO",url:"https://nasatv-lh.akamaihd.net/i/NASA_101@319270/master.m3u8"}
        ],
        online: true,
        category: "International"
      },
      {
        name: "Metro TV",
        stream: [
          {label:"AUTO",url:"https://content.jwplatform.com/manifests/yp34SRmf.m3u8"}
        ],
        online: false,
        category: "Berita"
      },
      {
        name: "CNN Indonesia",
        stream: [
          {label:"AUTO",url:"https://test-streams.mux.dev/x36xhzz/x36xhzz.m3u8"}
        ],
        online: true,
        category: "Berita"
      },
      {
        name: "Space Toon",
        stream: [
          {label:"AUTO",url:"https://test-streams.mux.dev/x36xhzz/x36xhzz.m3u8"}
        ],
        online: false,
        category: "Anak-anak"
      },
      {
        name: "Fashion TV",
        stream: [
          {label:"AUTO",url:"https://test-streams.mux.dev/x36xhzz/x36xhzz.m3u8"}
        ],
        online: true,
        category: "International"
      }
    ];

    // Category generation
    const CATEGORIES = ["Semua", ...Array.from(new Set(CHANNELS.map(ch => ch.category)))];

    let currentCategory = "Semua";
    let currentChannel = null;

    function renderCategories() {
      const container = document.getElementById('category-filter');
      container.innerHTML = '';
      CATEGORIES.forEach(cat => {
        const btn = document.createElement('button');
        btn.className = 'px-4 py-1 mb-1 rounded-full category-button text-sm font-medium select-none focus:outline-none transition ' +
          (cat === currentCategory ? 'category-selected bg-blue-50 shadow' : 'text-gray-700 hover:text-sky-600 bg-gray-50');
        btn.textContent = cat;
        btn.onclick = () => {
          currentCategory = cat;
          renderCategories();
          renderChannelList();
        };
        container.appendChild(btn);
      });
    }

    function renderChannelList() {
      const list = document.getElementById('channel-list');
      list.innerHTML = '';
      let channels = CHANNELS.filter(c => (currentCategory === "Semua" || c.category === currentCategory));
      if (channels.length === 0) {
        list.innerHTML = '<div class="text-gray-500 p-3 text-center">Tidak ada channel untuk kategori ini.</div>';
        return;
      }
      channels.forEach(channel => {
        const card = document.createElement('div');
        card.className = 'flex items-center px-2 py-3 gap-3 rounded-lg border shadow-sm cursor-pointer hover:bg-blue-50 transition';
        card.tabIndex = 0;
        card.onclick = () => selectChannel(channel, 0);
        card.onkeypress = e => { if (e.key === 'Enter') { selectChannel(channel, 0); } };
        if (currentChannel && channel.name === currentChannel.name) {
          card.classList.add('ring-2', 'ring-sky-400');
        }
        // Channel detail
        const detail = document.createElement('div');
        detail.className = 'flex-1 min-w-0';
        const title = document.createElement('div');
        title.textContent = channel.name;
        title.className = 'font-bold text-xl text-gray-800 truncate';
        const categ = document.createElement('div');
        categ.textContent = channel.category;
        categ.className = 'text-sm text-gray-500';
        detail.appendChild(title);
        detail.appendChild(categ);

        // Status
        const status = document.createElement('span');
        status.textContent = channel.online ? 'Online' : 'Offline';
        status.className = 'text-xs rounded-full px-2 py-1 border font-semibold ml-3 ' +
          (channel.online ? 'channel-active' : 'channel-offline');

        card.appendChild(detail);
        card.appendChild(status);

        list.appendChild(card);
      });
    }

    function selectChannel(channel, resolutionIdx) {
      currentChannel = channel;
      const player = document.getElementById('tv-player');
      // Remove all old sources, we do src programmatically
      player.pause();
      player.removeAttribute("src");
      player.innerHTML = '';
      document.getElementById('player-loading').style.display = '';
      // Multi-res support
      let idx = typeof resolutionIdx === "number" ? resolutionIdx : 0;
      if (!Array.isArray(channel.stream)) {
        // Backward compatible
        channel.stream = [{ label: 'AUTO', url: channel.stream }];
        idx = 0;
      }
      let url = channel.online ? channel.stream[idx].url : "";
      if (channel.online && window.Hls && !player.canPlayType('application/vnd.apple.mpegurl')) {
        // Using hls.js for maximum compatibility
        if (window._hls) { window._hls.destroy(); }
        window._hls = new Hls();
        window._hls.loadSource(url);
        window._hls.attachMedia(player);
        window._hls.on(Hls.Events.MANIFEST_PARSED, function(event, data) {
          document.getElementById('player-loading').style.display = 'none';
          if (data && data.levels) {
            // Manage resolutions
            const sel = document.getElementById('btn-res');
            sel.innerHTML = '';
            let foundLevel = false;
            if (channel.stream.length > 1) {
              channel.stream.forEach((x, i) => {
                const opt = document.createElement('option');
                opt.value = 'custom-' + i;
                opt.textContent = x.label;
                if (i === idx) opt.selected = true;
                sel.appendChild(opt);
              });
              foundLevel = true;
            }
            if (data.levels.length > 1) {
              // Show levels
              data.levels.forEach((level, i) => {
                let label = `${level.height}p`;
                if (!Array.from(sel.options).some(o => o.textContent == label)) {
                  const opt = document.createElement('option');
                  opt.value = '' + i;
                  opt.textContent = label;
                  sel.appendChild(opt);
                }
              });
              foundLevel = true;
            }
            sel.style.display = foundLevel ? '' : 'none';
            sel.classList.toggle("hidden", !foundLevel);
          }
        });
      } else if (channel.online) {
        player.src = url;
        setTimeout(() => document.getElementById('player-loading').style.display = 'none', 500);
      } else {
        player.removeAttribute("src");
        player.load();
      }
      // Info
      document.getElementById('currentChannelName').textContent = channel.name;
      document.getElementById('currentChannelStatus').textContent = channel.online ? 'Online' : 'Offline';
      document.getElementById('currentChannelStatus').className = 'inline-block mt-1 px-2 py-1 text-xs rounded-full font-semibold ' + (channel.online ? 'channel-active' : 'channel-offline');
      renderChannelList();
      // Setup resolution select
      const resSelect = document.getElementById('btn-res');
      resSelect.innerHTML = '';
      if (channel.stream.length > 1) {
        channel.stream.forEach((x, i) => {
          const opt = document.createElement('option');
          opt.value = 'custom-' + i;
          opt.textContent = x.label;
          if (i === idx) opt.selected = true;
          resSelect.appendChild(opt);
        });
        resSelect.style.display = '';
        resSelect.classList.remove("hidden");
      } else {
        resSelect.style.display = 'none';
        resSelect.classList.add("hidden");
      }
      resSelect.onchange = function() {
        const val = this.value;
        if (val.startsWith("custom-")) {
          let i = parseInt(val.replace('custom-', ''));
          selectChannel(channel, i);
        } else if (window._hls && !isNaN(val)) {
          _hls.currentLevel = parseInt(val);
        }
      }
      // reset mute button
      const muteBtn = document.getElementById('btn-mute');
      muteBtn.textContent = player.muted ? 'Unmute' : 'Mute';
      // Only play if online
      if (channel.online && player.paused) player.play().catch(() => { });
    }

    // Initialize everything after DOM is loaded
    document.addEventListener('DOMContentLoaded', function() {
      if (!window.Hls) {
        var s = document.createElement('script');
        s.src = 'https://cdn.jsdelivr.net/npm/hls.js@latest';
        document.head.appendChild(s);
      }
      renderCategories();
      renderChannelList();

      // Mute button functionality
      document.getElementById('btn-mute').onclick = () => {
        const player = document.getElementById('tv-player');
        player.muted = !player.muted;
        document.getElementById('btn-mute').textContent = player.muted ? 'Unmute' : 'Mute';
      };

      // Set up player events
      const player = document.getElementById('tv-player');
      
      // Fullscreen button functionality
      document.getElementById('btn-fs').onclick = () => {
        if (player.requestFullscreen) {
          player.requestFullscreen();
        } else if (player.webkitRequestFullscreen) {
          player.webkitRequestFullscreen();
        } else if (player.msRequestFullscreen) {
          player.msRequestFullscreen();
        }
      };
      player.addEventListener('waiting', () => {
        document.getElementById('player-loading').style.display = '';
      });
      player.addEventListener('playing', () => {
        document.getElementById('player-loading').style.display = 'none';
      });
      player.addEventListener('canplay', () => {
        document.getElementById('player-loading').style.display = 'none';
      });
      player.addEventListener('error', () => {
        document.getElementById('player-loading').style.display = 'none';
        if (currentChannel && currentChannel.online)
          alert('Maaf, channel gagal dimuat. Coba channel lain.');
      });
    });

  </script>
</body>
</html>
