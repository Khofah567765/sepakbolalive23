<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Jadwal Petugas Masjid Annur (Rotasi Independen)</title>
  <link rel="icon" href="favicon2.png" type="image/png">
    <style>
    @import url('https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600&display=swap');

    /* Palet Warna Tema Gelap */
    :root {
        --bg-color: #1a1b26;
        --card-bg-color: #24283b;
        --text-color: #c0caf5;
        --text-color-light: #a9b1d6;
        --border-color: #414868;
        --primary-color: #7aa2f7; /* Biru Primer */
        --primary-color-hover: #567de4;
        --secondary-color: #565f89; /* Abu-abu Sekunder */
        --secondary-color-hover: #414868;
        --success-color: #73daca; /* Hijau Sukses */
        --success-color-hover: #50c4a4;
        --danger-color: #f7768e;
    }

    * {
        box-sizing: border-box;
        margin: 0;
        padding: 0;
    }

    body {
        font-family: 'Poppins', sans-serif;
        background-color: var(--bg-color);
        color: var(--text-color);
        line-height: 1.6;
        padding: 20px; /* Padding dipindahkan ke body/container */
    }

    .container {
        max-width: 1200px;
        margin: 30px auto;
        padding: 20px;
    }
    
    /* --- HEADER & CLOCK (Disesuaikan) --- */
    .logo-header { 
        display: flex; 
        align-items: center; 
        padding: 20px; 
        background-color: var(--card-bg-color); /* Warna card baru */
        border-bottom: 1px solid var(--border-color); 
        border-radius: 12px; 
        margin-bottom: 20px;
    }
    .logo-img { 
        height: 60px; /* Dikecilkan sedikit agar serasi */
        margin-right: 15px; 
    }
    .logo-title { 
        font-size: 20px; 
        color: var(--text-color); 
        margin: 0; 
        font-weight: 600;
    }
    .header { 
        display: flex; 
        justify-content: space-between; 
        align-items: center; 
        margin-top: 10px; 
        margin-bottom: 20px; 
        font-weight: 500;
    }
    .clock { 
        font-size: 16px; 
        color: var(--success-color); 
        text-align: center; 
    }
    h1 { 
        font-size: 28px;
        font-weight: 600;
        color: var(--primary-color); 
        text-align: center;
        margin-bottom: 10px;
    }
    h2 { 
        font-size: 20px; 
        color: var(--primary-color);
        margin-bottom: 15px;
        font-weight: 600;
    }
    h3 { 
        font-size: 22px; 
        color: var(--text-color); 
        text-align: left; 
        margin-bottom: 10px;
        font-weight: 600;
    }

    /* --- DASHBOARD GRID & SECTION (Dari CSS Baru) --- */
    .dashboard-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
        gap: 20px;
        align-items: start;
    }
    .dashboard-section {
        background-color: var(--card-bg-color);
        border: 1px solid var(--border-color);
        border-radius: 12px;
        padding: 25px;
        transition: box-shadow 0.2s ease;
    }
    .dashboard-section:hover {
        box-shadow: 0 8px 25px rgba(0, 0, 0, 0.2);
    }

    /* --- Role Block (Disesuaikan agar serasi dengan card baru) --- */
    .role-block { 
        margin-bottom: 15px; 
        padding: 15px; 
        background-color: #2e334f; /* Warna latar belakang role block */
        border-radius: 8px; 
        text-align: center; 
        border: 1px solid var(--border-color);
    }
    .role-title { 
        font-weight: 600; 
        color: var(--text-color-light); 
        font-size: 16px; 
        margin-bottom: 5px; 
    }
    .role-name { 
        color: var(--text-color); 
        font-size: 18px; 
        margin-bottom: 10px; 
        font-weight: 500;
    }
    
    /* --- Tombol (Menggunakan kelas .btn dari CSS Baru) --- */
    .btn {
        padding: 10px 20px;
        border: none;
        border-radius: 6px;
        color: #fff;
        cursor: pointer;
        font-size: 14px;
        font-weight: 500;
        transition: background-color 0.2s ease, transform 0.2s ease;
        display: block; /* Agar tombol menjadi satu baris penuh */
        width: 100%;
        margin-top: 8px;
    }
    .btn:hover {
        transform: translateY(-1px);
    }
    .btn-secondary { /* Untuk GESER PENGGANTI */
        background-color: var(--primary-color);
    }
    .btn-secondary:hover {
        background-color: var(--primary-color-hover);
    }
    .btn-approve { /* Untuk KONFIRMASI SELESAI */
        background-color: var(--success-color);
        color: var(--bg-color); /* Ubah warna teks agar kontras di latar hijau muda */
    }
    .btn-approve:hover {
        background-color: var(--success-color-hover);
    }

    /* --- Daftar Nama (Disesuaikan) --- */
    .list-section { 
        display: flex; 
        flex-wrap: wrap; 
        gap: 20px; /* Jarak antar kolom daftar */
        justify-content: start; 
        margin-top: 30px;
    }
    .list-group { 
        background: var(--card-bg-color); 
        border-radius: 12px; 
        padding: 20px; 
        box-shadow: 0 3px 10px rgba(0,0,0,0.05); 
        width: 100%;
        max-width: 350px; /* Batasi lebar daftar */
        border: 1px solid var(--border-color);
    }
    .styled-list { 
        padding-left: 0; 
        margin: 0; 
        list-style-type: none; 
        margin-top: 5px;
    }
    .styled-list li { 
        margin-bottom: 5px; 
        padding: 5px 0;
        border-bottom: 1px dashed var(--border-color);
        display: flex; 
        justify-content: space-between;
    }
    .styled-list li:last-child {
        border-bottom: none;
    }
    .styled-list .list-name { 
        font-weight: 500; 
        color: var(--text-color);
    }

    /* === Modal Styles (Disesuaikan agar serasi dengan card baru) === */
    .modal-overlay {
        position: fixed; top: 0; left: 0; width: 100%; height: 100%; 
        background: rgba(0, 0, 0, 0.7); display: flex; justify-content: center; 
        align-items: center; z-index: 1000; visibility: hidden; opacity: 0;
        transition: visibility 0s, opacity 0.3s;
    }
    .modal-content {
        background: var(--card-bg-color); 
        padding: 25px; border-radius: 10px; max-width: 90%; width: 350px;
        box-shadow: 0 4px 8px rgba(0, 0, 0, 0.5);
    }
    .modal-list button {
        display: block; width: 100%; padding: 10px; margin-bottom: 8px;
        background-color: #2e334f; border: 1px solid var(--border-color);
        border-radius: 5px; text-align: center; cursor: pointer; font-size: 16px;
        color: var(--text-color); transition: background-color 0.2s;
    }
    .modal-list button:hover {
        background-color: var(--secondary-color);
    }
    .modal-header {
        font-weight: 600; margin-bottom: 15px; font-size: 1.2rem;
        color: var(--primary-color); text-align: center;
    }
    .show-modal {
        visibility: visible; opacity: 1;
    }

    /* Media Query untuk Tampilan Mobile */
    @media (max-width: 650px) {
        body { padding: 10px; }
        .logo-header { flex-direction: column; text-align: center; }
        .logo-title { margin-top: 10px; font-size: 18px; }
        .header { flex-direction: column; align-items: center; }
        .list-section { flex-direction: column; align-items: center; }
        .list-group { max-width: 100%; }
    }
  </style>
</head>
<body>
  
  <div class="container">
    
    <header class="logo-header">
      <img src="favicon2.png" alt="Logo Masjid" class="logo-img">
      <h1 class="logo-title">JADWAL PETUGAS SHOLAT JUMAT MASJID ANNUR</h1>
    </header>

    <div class="header">
      <div class="clock" id="clock">Memuat waktu...</div>
    </div>
    
        <iframe src="Jadwalsholat.html" width="380" height="320" scrolling="no" style="border: none; margin-bottom: 20px;"></iframe>

        <div class="dashboard-grid">
      
            <div class="dashboard-section">
        <h2>JUMAT INI (Manual Konfirmasi Per Kolom)</h2>
        
                <div class="role-block">
          <div class="role-title">KHOTIB</div>
          <div class="role-name" id="khotibThis"></div>
          <button onclick="showNameSelection('khotib')" class="btn btn-secondary">GESER PENGGANTI KHOTIB</button>
          <button onclick="confirmScheduleComplete('khotib')" class="btn btn-approve">KONFIRMASI JADWAL SELESAI</button>
        </div>

                <div class="role-block">
          <div class="role-title">BILAL</div>
          <div class="role-name" id="bilalThis"></div>
          <button onclick="showNameSelection('bilal')" class="btn btn-secondary">GESER PENGGANTI BILAL</button>
          <button onclick="confirmScheduleComplete('bilal')" class="btn btn-approve">KONFIRMASI JADWAL SELESAI</button>
        </div>

                <div class="role-block">
          <div class="role-title">MUADZIN</div>
          <div class="role-name" id="muadzinThis"></div>
          <button onclick="showNameSelection('muadzin')" class="btn btn-secondary">GESER PENGGANTI MUADZIN</button>
          <button onclick="confirmScheduleComplete('muadzin')" class="btn btn-approve">KONFIRMASI JADWAL SELESAI</button>
        </div>
      </div>

            <div class="dashboard-section">
        <h2>JUMAT AKAN DATANG</h2>
        
        <div class="role-block">
          <div class="role-title">KHOTIB</div>
          <div class="role-name" id="khotibNext"></div>
        </div>

        <div class="role-block">
          <div class="role-title">BILAL</div>
          <div class="role-name" id="bilalNext"></div>
        </div>

        <div class="role-block">
          <div class="role-title">MUADZIN</div>
          <div class="role-name" id="muadzinNext"></div>
        </div>
      </div>
    </div>
    
    <h2 style="text-align: center; margin-top: 30px; color: var(--text-color-light);">
      JADWAL MAJU KE MINGGU DEPAN HANYA SETELAH TOMBOL KONFIRMASI PER KOLOM DIKLIK
    </h2>
    
        <section class="list-section">
      
      <div class="list-group">
        <h3>DAFTAR NAMA PETUGAS</h3>
        
        <h2>KHOTIB (Urutan Rotasi)</h2>
        <ul id="khotibList" class="styled-list"></ul>
      </div>
      
      <div class="list-group">
        <h2>BILAL (Urutan Rotasi)</h2>
        <ul id="bilalList" class="styled-list"></ul>
      </div>
      
      <div class="list-group">
        <h2>MUADZIN (Urutan Rotasi)</h2>      
        <ul id="muadzinList" class="styled-list"></ul>
      </div>
    </section>

        <div id="substituteModal" class="modal-overlay">
        <div class="modal-content">
            <div id="modalHeader" class="modal-header">Pilih Petugas Pengganti</div>
            <div id="modalList" class="modal-list"></div>
            <button onclick="document.getElementById('substituteModal').classList.remove('show-modal')" class="btn btn-secondary" style="margin-top: 15px;">Batal</button>
        </div>
    </div>

  </div>   <script>
    // === Data Petugas (Menggunakan LET untuk memungkinkan perubahan urutan) ===
    let khotib = ["K. M. MUNIR", "Ust. ZAINI", "Ust. A. FIRDAUSI", "Ust. A. JUNAIDI"];
    let bilal = ["Ust. MUHTADI", "MISDI", "ARIF RAHMAN HAKIM", "MISTUM", "Ust. SYAIFUL"];
    let muadzin = ["SUNAHWAN", "ALFIN", "AMIL YORDAN"];
    
    // Kunci Penyimpanan untuk Indeks Rotasi Per Kolom
    const STORAGE_KEY_INDEX_KHOTIB = 'index_khotib';
    const STORAGE_KEY_INDEX_BILAL = 'index_bilal';
    const STORAGE_KEY_INDEX_MUADZIN = 'index_muadzin';
    
    // Kunci Penyimpanan untuk Urutan Petugas (Geser Pengganti)
    const STORAGE_KEY_DATA_KHOTIB = 'data_khotib';
    const STORAGE_KEY_DATA_BILAL = 'data_bilal';
    const STORAGE_KEY_DATA_MUADZIN = 'data_muadzin';


    // === 1. Load Data dari LocalStorage ===
    function loadDataFromStorage() {
        const roles = [
            { name: 'khotib', array: khotib, key: STORAGE_KEY_DATA_KHOTIB },
            { name: 'bilal', array: bilal, key: STORAGE_KEY_DATA_BILAL },
            { name: 'muadzin', array: muadzin, key: STORAGE_KEY_DATA_MUADZIN }
        ];

        roles.forEach(role => {
            const storedData = localStorage.getItem(role.key);
            if (storedData) {
                if (role.name === 'khotib') khotib = JSON.parse(storedData);
                else if (role.name === 'bilal') bilal = JSON.parse(storedData);
                else if (role.name === 'muadzin') muadzin = JSON.parse(storedData);
            }
        });
    }
    loadDataFromStorage();
    
    // === FUNGSI BANTUAN: Mendapatkan Indeks Rotasi Saat Ini ===
    function getCurrentRotationIndex(role) {
        let storageKey;
        if (role === 'khotib') storageKey = STORAGE_KEY_INDEX_KHOTIB;
        else if (role === 'bilal') storageKey = STORAGE_KEY_INDEX_BILAL;
        else if (role === 'muadzin') storageKey = STORAGE_KEY_INDEX_MUADZIN;
        
        // Mengambil indeks rotasi yang tersimpan, defaultnya 0 jika belum ada.
        return parseInt(localStorage.getItem(storageKey) || 0);
    }


    // === FUNGSI UNTUK MERENDER DAFTAR NAMA ===
    function renderLists() {
        // Menggunakan Indeks Rotasi Individual
        const indexKhotib = getCurrentRotationIndex('khotib');
        const indexBilal = getCurrentRotationIndex('bilal');
        const indexMuadzin = getCurrentRotationIndex('muadzin');
        
        const lists = [
            { id: 'khotibList', data: khotib, startIndex: indexKhotib },
            { id: 'bilalList', data: bilal, startIndex: indexBilal },
            { id: 'muadzinList', data: muadzin, startIndex: indexMuadzin }
        ];

        lists.forEach(item => {
            const ul = document.getElementById(item.id);
            if (!ul) return; 
            ul.innerHTML = ''; 

            const scheduledIndex = item.startIndex % item.data.length;
            
            // Circular shift untuk menampilkan urutan yang dimulai dari petugas saat ini
            const chronologicalRotation = [
                ...item.data.slice(scheduledIndex),
                ...item.data.slice(0, scheduledIndex)
            ];
            
            chronologicalRotation.forEach((name, index) => {
                const li = document.createElement('li');
                const nameSpan = document.createElement('span');
                nameSpan.classList.add('list-name');
                nameSpan.innerText = `${index + 1}. ${name}`; 
                li.appendChild(nameSpan);
                ul.appendChild(li);
            });
        });
    }


    // === 2. Fungsi Pembuka Modal Pilihan Nama (Menggunakan Index Per Kolom) ===
    function showNameSelection(role) {
        let arrayToUse;
        if (role === 'khotib') arrayToUse = khotib;
        else if (role === 'bilal') arrayToUse = bilal;
        else if (role === 'muadzin') arrayToUse = muadzin;
        else return;

        const roleName = role.charAt(0).toUpperCase() + role.slice(1);
        const currentIndex = getCurrentRotationIndex(role) % arrayToUse.length;
        const scheduledPerson = arrayToUse[currentIndex];
        
        const modalHeader = document.getElementById('modalHeader');
        const modalList = document.getElementById('modalList');
        
        modalHeader.innerText = `Pilih ${roleName} Pengganti (S) untuk ${scheduledPerson}`;
        modalList.innerHTML = ''; 

        arrayToUse.forEach(name => {
            if (name !== scheduledPerson) { 
                const button = document.createElement('button');
                button.innerText = name;
                button.setAttribute('onclick', `handleSubstituteSelection('${role}', '${name}')`);
                modalList.appendChild(button);
            }
        });

        document.getElementById('substituteModal').classList.add('show-modal');
    }

    // === 3. Fungsi Inti: Handle Pilihan dan Geser Nama (Logika Geser SAMA) ===
    function handleSubstituteSelection(role, substituteName) {
        document.getElementById('substituteModal').classList.remove('show-modal');

        let arrayToModify;
        let storageKeyData;
        
        if (role === 'khotib') { arrayToModify = khotib; storageKeyData = STORAGE_KEY_DATA_KHOTIB; }
        else if (role === 'bilal') { arrayToModify = bilal; storageKeyData = STORAGE_KEY_DATA_BILAL; }
        else if (role === 'muadzin') { arrayToModify = muadzin; storageKeyData = STORAGE_KEY_DATA_MUADZIN; }
        else return;

        const roleName = role.charAt(0).toUpperCase() + role.slice(1);
        const substituteIndex = arrayToModify.indexOf(substituteName);

        const currentIndex = getCurrentRotationIndex(role) % arrayToModify.length;
        const scheduledPerson = arrayToModify[currentIndex];

        if (!confirm(`Yakin menggeser ${roleName} PENGGANTI: **${substituteName}** ke urutan paling belakang? \n\nRotasi akan berubah: ${scheduledPerson} tetap di jadwal JUMAT INI, dan ${substituteName} pindah ke urutan terakhir.`)) {
            return;
        }

        // --- LOGIKA GESER (Sama untuk semua peran) ---
        const [removed] = arrayToModify.splice(substituteIndex, 1); 
        arrayToModify.push(removed);
        // --- AKHIR LOGIKA GESER ---

        localStorage.setItem(storageKeyData, JSON.stringify(arrayToModify));
        
        updateSchedule(); 
        
        alert(`✅ ${roleName} ${substituteName} telah berhasil digeser ke urutan terakhir. Rotasi ${roleName} minggu depan akan menggunakan urutan baru.`);
    }

    // === 4. FUNGSI KONFIRMASI JADWAL SELESAI (Per Kolom) ===
    function confirmScheduleComplete(role) {
        const roleName = role.charAt(0).toUpperCase() + role.slice(1);
        let storageKeyIndex;
        let arrayToUse;
        
        if (role === 'khotib') { storageKeyIndex = STORAGE_KEY_INDEX_KHOTIB; arrayToUse = khotib; }
        else if (role === 'bilal') { storageKeyIndex = STORAGE_KEY_INDEX_BILAL; arrayToUse = bilal; }
        else if (role === 'muadzin') { storageKeyIndex = STORAGE_KEY_INDEX_MUADZIN; arrayToUse = muadzin; }
        else return;

        let currentIndex = getCurrentRotationIndex(role);
        const scheduledPerson = arrayToUse[currentIndex % arrayToUse.length];

        if (!confirm(`Konfirmasi tugas **${roleName}** sudah SELESAI? \n\nPetugas ${roleName} saat ini: **${scheduledPerson}**. \nMengklik OK akan memajukan rotasi ${roleName} ke orang berikutnya.`)) {
            return;
        }
        
        // 1. Majukan Indeks Rotasi
        const newIndex = currentIndex + 1;
        localStorage.setItem(storageKeyIndex, newIndex);

        updateSchedule();
        alert(`✅ Jadwal **${roleName}** sukses dimajukan! Petugas berikutnya sudah ditampilkan.`);
    }

    // --- Fungsi Update Waktu ---
    function updateClock() {
        const now = new Date();
        const waktu = now.toLocaleTimeString('id-ID');
        const tanggal = now.toLocaleDateString('id-ID', {
            weekday: 'long', year: 'numeric', month: 'long', day: 'numeric'
        });
        document.getElementById("clock").innerText = `${tanggal} - ${waktu}`;
    }

    // --- 6. Fungsi Update Utama ---
    function updateSchedule() {
        updateClock();
        renderLists(); 
        
        // Ambil Indeks Rotasi untuk Tampilan 'JUMAT INI'
        const indexThisKhotib = getCurrentRotationIndex('khotib');
        const indexThisBilal = getCurrentRotationIndex('bilal');
        const indexThisMuadzin = getCurrentRotationIndex('muadzin');

        // Ambil Indeks Rotasi untuk Tampilan 'JUMAT AKAN DATANG' (Indeks saat ini + 1)
        const indexNextKhotib = indexThisKhotib + 1;
        const indexNextBilal = indexThisBilal + 1;
        const indexNextMuadzin = indexThisMuadzin + 1;


        // --- TAMPILAN NAMA UTAMA (JUMAT INI) ---
        document.getElementById("khotibThis").innerText = khotib[indexThisKhotib % khotib.length];
        document.getElementById("bilalThis").innerText = bilal[indexThisBilal % bilal.length];
        document.getElementById("muadzinThis").innerText = muadzin[indexThisMuadzin % muadzin.length];

        // --- TAMPILAN NAMA UTAMA (JUMAT AKAN DATANG) ---
        document.getElementById("khotibNext").innerText = khotib[indexNextKhotib % khotib.length];
        document.getElementById("bilalNext").innerText = bilal[indexNextBilal % bilal.length];
        document.getElementById("muadzinNext").innerText = muadzin[indexNextMuadzin % muadzin.length];
    }

    // Mulai update setiap detik
    setInterval(updateSchedule, 1000);
    updateSchedule(); 
</script>
</body>
</html>
