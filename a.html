<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sistem Masjid Lengkap</title>
    
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.0/font/bootstrap-icons.css">
    
    <style>
        body { background-color: #f4f6f9; font-family: 'Segoe UI', sans-serif; }
        .login-container { height: 100vh; display: flex; align-items: center; justify-content: center; }
        .card-login { width: 100%; max-width: 400px; padding: 25px; border-radius: 15px; }
        #dashboard-view { display: none; padding-top: 30px; padding-bottom: 100px; }
        
        .saldo-box { background: linear-gradient(135deg, #198754, #20c997); color: white; padding: 25px; border-radius: 15px; margin-bottom: 25px; position: relative; overflow: hidden; }
        .saldo-box::after { content: "\F51E"; font-family: "Bootstrap-icons"; position: absolute; right: 20px; bottom: -10px; font-size: 5rem; opacity: 0.2; }
        
        /* Highlight Antrian */
        .list-group-item:first-child { background-color: #e8f5e9; font-weight: bold; border-left: 5px solid #198754; }
        
        /* Proyeksi Table */
        .table-proyeksi thead { background-color: #6c757d; color: white; }
        .table-proyeksi tbody tr:first-child { background-color: #fff3cd; font-weight: bold; }

        /* MODE CETAK (PRINT) */
        @media print {
            body { background-color: white; }
            #dashboard-view { padding-top: 0; }
            /* Sembunyikan elemen yang tidak perlu saat print */
            .no-print, .nav-pills, .accordion, .card-header button, .btn, #login-view, .input-card { display: none !important; }
            .card { border: none !important; box-shadow: none !important; margin-bottom: 0 !important; }
            .table { border: 1px solid #000 !important; width: 100%; }
            .table th, .table td { border: 1px solid #000 !important; padding: 8px; }
            /* Tampilkan Header Laporan */
            #print-header { display: block !important; text-align: center; margin-bottom: 20px; border-bottom: 2px solid black; padding-bottom: 10px; }
        }
        #print-header { display: none; }
    </style>
</head>
<body>

    <div id="print-header">
        <h2>LAPORAN KAS MASJID</h2>
        <p id="print-periode">Periode: Semua Data</p>
    </div>

    <div id="login-view" class="login-container no-print">
        <div class="card card-login shadow-lg border-0">
            <div class="text-center mb-4">
                <i class="bi bi-mosque display-1 text-success"></i>
                <h3 class="mt-3">Admin Masjid</h3>
            </div>
            <div class="mb-3"><input type="email" id="email" class="form-control" placeholder="Email"></div>
            <div class="mb-3"><input type="password" id="password" class="form-control" placeholder="Password"></div>
            <button onclick="login()" class="btn btn-success w-100 mb-2">MASUK</button>
            <button onclick="register()" class="btn btn-outline-secondary w-100">Daftar</button>
        </div>
    </div>

    <div id="dashboard-view" class="container">
        <div class="d-flex justify-content-between align-items-center mb-4 bg-white p-3 rounded shadow-sm sticky-top no-print">
            <h5 class="m-0 text-success fw-bold"><i class="bi bi-grid-fill"></i> Dashboard Masjid</h5>
            <button onclick="logout()" class="btn btn-danger btn-sm px-3">Logout</button>
        </div>

        <ul class="nav nav-pills mb-4 justify-content-center no-print" id="pills-tab" role="tablist">
            <li class="nav-item"><button class="nav-link active" id="pills-keuangan-tab" data-bs-toggle="pill" data-bs-target="#pills-keuangan"><i class="bi bi-wallet2"></i> Keuangan & Laporan</button></li>
            <li class="nav-item"><button class="nav-link" id="pills-jumat-tab" data-bs-toggle="pill" data-bs-target="#pills-jumat"><i class="bi bi-calendar-check"></i> Jadwal Jumat</button></li>
        </ul>

        <div class="tab-content" id="pills-tabContent">
            
            <div class="tab-pane fade show active" id="pills-keuangan">
                
                <div class="saldo-box shadow">
                    <h6 class="opacity-75">Total Saldo Kas Saat Ini</h6>
                    <h1 id="total-saldo" class="fw-bold">Rp 0</h1>
                </div>

                <div class="row mb-4 input-card no-print">
                    <div class="col-md-8">
                        <div class="card shadow-sm h-100">
                            <div class="card-header bg-success text-white fw-bold">Input Transaksi Baru</div>
                            <div class="card-body">
                                <div class="row g-2">
                                    <div class="col-md-3"><input type="date" id="tgl" class="form-control"></div>
                                    <div class="col-md-3"><select id="kategori" class="form-select"><option value="masuk">Pemasukan (+)</option><option value="keluar">Pengeluaran (-)</option></select></div>
                                    <div class="col-md-4"><input type="text" id="keterangan" class="form-control" placeholder="Keterangan (Cth: Infaq)"></div>
                                    <div class="col-md-2"><input type="number" id="jumlah" class="form-control" placeholder="Rp"></div>
                                </div>
                                <button onclick="simpanData()" class="btn btn-success w-100 mt-3">SIMPAN</button>
                            </div>
                        </div>
                    </div>
                    
                    <div class="col-md-4">
                        <div class="card shadow-sm h-100 border-primary">
                            <div class="card-header bg-primary text-white fw-bold"><i class="bi bi-filter"></i> Filter Laporan</div>
                            <div class="card-body">
                                <label class="small">Pilih Bulan & Tahun:</label>
                                <div class="input-group mb-3">
                                    <input type="month" id="filter_bulan" class="form-control" onchange="filterData()">
                                    <button onclick="resetFilter()" class="btn btn-outline-secondary" title="Tampilkan Semua">Reset</button>
                                </div>
                                <button onclick="window.print()" class="btn btn-primary w-100"><i class="bi bi-printer"></i> CETAK LAPORAN</button>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="row mb-3 text-center" id="summary-row">
                    <div class="col-md-6">
                        <div class="alert alert-success py-2">
                            <small>Pemasukan Periode Ini</small><br>
                            <b id="sum-masuk" class="fs-5">Rp 0</b>
                        </div>
                    </div>
                    <div class="col-md-6">
                        <div class="alert alert-danger py-2">
                            <small>Pengeluaran Periode Ini</small><br>
                            <b id="sum-keluar" class="fs-5">Rp 0</b>
                        </div>
                    </div>
                </div>

                <div class="card shadow-sm">
                    <div class="card-body">
                        <h5 class="card-title no-print">Rincian Transaksi</h5>
                        <table class="table table-hover table-bordered table-striped">
                            <thead class="table-light">
                                <tr>
                                    <th>Tanggal</th>
                                    <th>Keterangan</th>
                                    <th class="text-end">Masuk</th>
                                    <th class="text-end">Keluar</th>
                                    <th class="no-print text-center">Aksi</th>
                                </tr>
                            </thead>
                            <tbody id="tabel-body"></tbody>
                            <tfoot class="table-light fw-bold">
                                <tr>
                                    <td colspan="2" class="text-end">TOTAL PERIODE INI:</td>
                                    <td class="text-end text-success" id="foot-masuk">0</td>
                                    <td class="text-end text-danger" id="foot-keluar">0</td>
                                    <td class="no-print"></td>
                                </tr>
                            </tfoot>
                        </table>
                    </div>
                </div>
            </div>

            <div class="tab-pane fade" id="pills-jumat">
                <div class="card shadow-sm mb-4 border-info no-print">
                    <div class="card-header bg-info text-white fw-bold"><i class="bi bi-eye"></i> Proyeksi Bulan Ini</div>
                    <div class="card-body">
                        <div class="table-responsive">
                            <table class="table table-bordered table-sm table-proyeksi text-center">
                                <thead><tr><th>Tanggal</th><th>Khotib</th><th>Bilal</th><th>Muadzin</th></tr></thead>
                                <tbody id="tabel-proyeksi"><tr><td colspan="4">Loading...</td></tr></tbody>
                            </table>
                        </div>
                    </div>
                </div>

                <div class="card shadow-sm mb-4 border-success no-print">
                    <div class="card-header bg-success text-white fw-bold d-flex justify-content-between align-items-center">
                        <span><i class="bi bi-pencil-square"></i> Buat Jadwal Fix (Minggu Ini)</span>
                        <button onclick="suggestTopList()" class="btn btn-sm btn-light text-success fw-bold">üîÑ Ambil Urutan Teratas</button>
                    </div>
                    <div class="card-body">
                        <div class="row g-3">
                            <div class="col-md-3"><label class="small fw-bold">Tanggal</label><input type="date" id="jumat_tgl" class="form-control fw-bold"></div>
                            <div class="col-md-3"><label class="small fw-bold text-success">Khotib</label><select id="select_khotib" class="form-select"></select></div>
                            <div class="col-md-3"><label class="small fw-bold text-success">Bilal</label><select id="select_bilal" class="form-select"></select></div>
                            <div class="col-md-3"><label class="small fw-bold text-success">Muadzin</label><select id="select_muadzin" class="form-select"></select></div>
                        </div>
                        <button onclick="simpanJadwal()" class="btn btn-success w-100 mt-3 fw-bold">SIMPAN RENCANA</button>
                    </div>
                </div>

                <div class="card shadow-sm mb-4">
                    <div class="card-body">
                        <h5 class="card-title">Konfirmasi Petugas (Hari H)</h5>
                        <div class="table-responsive">
                            <table class="table table-bordered align-middle">
                                <thead class="table-dark">
                                    <tr class="text-center"><th width="15%">Tanggal</th><th width="25%">Khotib</th><th width="25%">Bilal</th><th width="25%">Muadzin</th><th width="10%" class="no-print">Aksi</th></tr>
                                </thead>
                                <tbody id="tabel-jumat"></tbody>
                            </table>
                        </div>
                    </div>
                </div>

                <div class="accordion shadow-sm no-print" id="accordionMaster">
                    <div class="accordion-item">
                        <h2 class="accordion-header"><button class="accordion-button collapsed bg-light" type="button" data-bs-toggle="collapse" data-bs-target="#collapseMaster">‚öôÔ∏è Lihat Antrian Master Data</button></h2>
                        <div id="collapseMaster" class="accordion-collapse collapse" data-bs-parent="#accordionMaster">
                            <div class="accordion-body">
                                <div class="row">
                                    <div class="col-md-4 mb-3"><h6 class="fw-bold text-success">Antrian Khotib</h6><div class="input-group mb-2"><input type="text" id="new_khotib" class="form-control form-control-sm" placeholder="Nama"><button onclick="tambahMaster('khotib')" class="btn btn-sm btn-success">+</button></div><ol id="list_khotib_view" class="list-group list-group-numbered list-group-flush small"></ol></div>
                                    <div class="col-md-4 mb-3"><h6 class="fw-bold text-warning">Antrian Bilal</h6><div class="input-group mb-2"><input type="text" id="new_bilal" class="form-control form-control-sm" placeholder="Nama"><button onclick="tambahMaster('bilal')" class="btn btn-sm btn-success">+</button></div><ol id="list_bilal_view" class="list-group list-group-numbered list-group-flush small"></ol></div>
                                    <div class="col-md-4 mb-3"><h6 class="fw-bold text-info">Antrian Muadzin</h6><div class="input-group mb-2"><input type="text" id="new_muadzin" class="form-control form-control-sm" placeholder="Nama"><button onclick="tambahMaster('muadzin')" class="btn btn-sm btn-success">+</button></div><ol id="list_muadzin_view" class="list-group list-group-numbered list-group-flush small"></ol></div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="modal fade" id="modalGanti" tabindex="-1">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header bg-warning"><h5 class="modal-title fw-bold">Ganti Petugas</h5><button type="button" class="btn-close" data-bs-dismiss="modal"></button></div>
                <div class="modal-body">
                    <p>Petugas Awal: <b id="nama_lama_display">...</b> (Tidak Hadir)</p>
                    <label class="form-label fw-bold mt-2">Pilih Pengganti:</label>
                    <input type="hidden" id="ganti_id_jadwal"><input type="hidden" id="ganti_role">
                    <select id="pilih_pengganti" class="form-select mb-3"></select>
                    <div class="alert alert-danger small">Petugas pengganti akan dipindah ke <b>Urutan Terbawah</b> antrian.</div>
                </div>
                <div class="modal-footer"><button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Batal</button><button type="button" onclick="prosesGanti()" class="btn btn-primary">Simpan</button></div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.0.0/firebase-app.js";
        import { getAuth, signInWithEmailAndPassword, createUserWithEmailAndPassword, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/10.0.0/firebase-auth.js";
        import { getFirestore, collection, addDoc, onSnapshot, deleteDoc, doc, query, orderBy, setDoc, updateDoc, arrayUnion, arrayRemove } from "https://www.gstatic.com/firebasejs/10.0.0/firebase-firestore.js";

        const firebaseConfig = {
          apiKey: "AIzaSyAAKGANXaFlagRj71Ibt0WBDNuOZ2e8BuQ",
          authDomain: "kasirq-main-f3b4c.firebaseapp.com",
          projectId: "kasirq-main-f3b4c",
          storageBucket: "kasirq-main-f3b4c.firebasestorage.app",
          messagingSenderId: "1044462245771",
          appId: "1:1044462245771:web:4af4e69289928edd14818e",
          measurementId: "G-7CLRV6VSMK"
        };

        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const db = getFirestore(app);
        let masterDataCache = {};
        let modalGantiBootstrap = null;
        let allFinanceData = []; // Menyimpan semua data keuangan di memori

        window.login = () => signInWithEmailAndPassword(auth, document.getElementById('email').value, document.getElementById('password').value).catch(e=>alert(e.message));
        window.register = () => createUserWithEmailAndPassword(auth, document.getElementById('email').value, document.getElementById('password').value).catch(e=>alert(e.message));
        window.logout = () => signOut(auth);

        onAuthStateChanged(auth, (user) => {
            if (user) {
                document.getElementById('login-view').style.display = 'none';
                document.getElementById('dashboard-view').style.display = 'block';
                modalGantiBootstrap = new bootstrap.Modal(document.getElementById('modalGanti'));
                initApp();
            } else {
                document.getElementById('login-view').style.display = 'flex';
                document.getElementById('dashboard-view').style.display = 'none';
            }
        });

        function initApp() {
            bacaDataKeuangan();
            initMasterData();
            bacaDataJumat();
            // Set filter bulan ke bulan ini
            const today = new Date();
            const yyyy = today.getFullYear();
            const mm = String(today.getMonth()+1).padStart(2,'0');
            document.getElementById('filter_bulan').value = `${yyyy}-${mm}`;
        }

        // --- KEUANGAN SYSTEM (UPGRADED) ---
        window.simpanData = async () => {
            const tgl=document.getElementById('tgl').value,k=document.getElementById('kategori').value,kt=document.getElementById('keterangan').value,j=Number(document.getElementById('jumlah').value);
            if(tgl&&kt&&j) await addDoc(collection(db,"keuangan"),{tanggal:tgl,kategori:k,keterangan:kt,jumlah:j});
            document.getElementById('jumlah').value=''; document.getElementById('keterangan').value='';
        };

        function bacaDataKeuangan() {
            const q = query(collection(db, "keuangan"), orderBy("tanggal", "desc"));
            onSnapshot(q, (s) => {
                allFinanceData = []; // Reset local data
                let totalSaldo = 0;
                s.forEach(d => {
                    const data = d.data();
                    data.id = d.id;
                    allFinanceData.push(data);
                    if(data.kategori == 'masuk') totalSaldo += data.jumlah; else totalSaldo -= data.jumlah;
                });
                
                // Update Saldo Utama (Selalu Total Keseluruhan)
                document.getElementById('total-saldo').innerText = "Rp " + totalSaldo.toLocaleString('id-ID');
                
                // Render Tabel sesuai Filter
                filterData();
            });
        }

        window.filterData = () => {
            const filterVal = document.getElementById('filter_bulan').value; // format: 2023-11
            let filtered = allFinanceData;
            
            if (filterVal) {
                filtered = allFinanceData.filter(item => item.tanggal.startsWith(filterVal));
                document.getElementById('print-periode').innerText = "Periode: " + filterVal;
            } else {
                document.getElementById('print-periode').innerText = "Periode: Semua Data";
            }

            let html = "";
            let sumMasuk = 0;
            let sumKeluar = 0;

            filtered.forEach(data => {
                if(data.kategori == 'masuk') sumMasuk += data.jumlah; else sumKeluar += data.jumlah;
                
                html += `<tr>
                    <td>${data.tanggal}</td>
                    <td>${data.keterangan}</td>
                    <td class="text-end text-success">${data.kategori=='masuk' ? data.jumlah.toLocaleString() : '-'}</td>
                    <td class="text-end text-danger">${data.kategori=='keluar' ? data.jumlah.toLocaleString() : '-'}</td>
                    <td class="no-print text-center"><button onclick="hapusData('keuangan','${data.id}')" class="btn btn-sm btn-danger">X</button></td>
                </tr>`;
            });

            document.getElementById('tabel-body').innerHTML = html;
            // Update Ringkasan Bawah & Kotak Info
            document.getElementById('foot-masuk').innerText = sumMasuk.toLocaleString();
            document.getElementById('foot-keluar').innerText = sumKeluar.toLocaleString();
            document.getElementById('sum-masuk').innerText = "Rp " + sumMasuk.toLocaleString();
            document.getElementById('sum-keluar').innerText = "Rp " + sumKeluar.toLocaleString();
        };

        window.resetFilter = () => {
            document.getElementById('filter_bulan').value = '';
            filterData();
        };

        // --- JADWAL JUMAT SYSTEM (SAME AS BEFORE) ---
        function initMasterData() {
            ['khotib', 'bilal', 'muadzin'].forEach(tipe => {
                onSnapshot(doc(db, "master_data", tipe), (docSnap) => {
                    if (docSnap.exists()) {
                        const list = docSnap.data().list || [];
                        masterDataCache[tipe] = list;
                        renderMaster(tipe, list);
                        renderProyeksi();
                    } else { setDoc(doc(db, "master_data", tipe), { list: [] }); }
                });
            });
        }
        function renderProyeksi() {
            let nextFriday = new Date(); nextFriday.setDate(nextFriday.getDate() + (5 + 7 - nextFriday.getDay()) % 7);
            let html = "";
            for(let i=0; i<4; i++) {
                let d = new Date(nextFriday); d.setDate(nextFriday.getDate() + (i * 7));
                const kName = (masterDataCache['khotib']||[])[i%(masterDataCache['khotib']||[]).length] || '-';
                const bName = (masterDataCache['bilal']||[])[i%(masterDataCache['bilal']||[]).length] || '-';
                const mName = (masterDataCache['muadzin']||[])[i%(masterDataCache['muadzin']||[]).length] || '-';
                html += `<tr><td>${d.toLocaleDateString('id-ID',{day:'numeric',month:'short'})}</td><td class="fw-bold text-success">${kName}</td><td>${bName}</td><td>${mName}</td></tr>`;
            }
            document.getElementById('tabel-proyeksi').innerHTML = html;
        }
        function renderMaster(tipe, arr) {
            const selectEl = document.getElementById(`select_${tipe}`);
            let optHtml = ``; arr.forEach(nama => optHtml += `<option value="${nama}">${nama}</option>`); selectEl.innerHTML = optHtml;
            const listEl = document.getElementById(`list_${tipe}_view`);
            let listHtml = ""; arr.forEach((nama, i) => { listHtml += `<li class="list-group-item d-flex justify-content-between align-items-center"><span>${nama}</span><button onclick="hapusMasterNama('${tipe}', '${nama}')" class="btn btn-sm text-danger">&times;</button></li>`; }); listEl.innerHTML = listHtml;
        }
        window.suggestTopList = () => {
            let nextFriday = new Date(); nextFriday.setDate(nextFriday.getDate() + (5 + 7 - nextFriday.getDay()) % 7);
            const yyyy = nextFriday.getFullYear(); const mm = String(nextFriday.getMonth() + 1).padStart(2, '0'); const dd = String(nextFriday.getDate()).padStart(2, '0');
            document.getElementById('jumat_tgl').value = `${yyyy}-${mm}-${dd}`;
            ['khotib', 'bilal', 'muadzin'].forEach(tipe => { const list = masterDataCache[tipe] || []; if(list.length > 0) document.getElementById(`select_${tipe}`).value = list[0]; });
            alert("Formulir terisi dengan urutan pertama antrian.");
        };
        window.simpanJadwal = async () => {
            const tgl = document.getElementById('jumat_tgl').value, k = document.getElementById('select_khotib').value, b = document.getElementById('select_bilal').value, m = document.getElementById('select_muadzin').value;
            if(tgl&&k) { await addDoc(collection(db, "jadwal_jumat"), { tanggal: tgl, khotib: k, status_khotib: 'pending', bilal: b, status_bilal: 'pending', muadzin: m, status_muadzin: 'pending' }); alert("Tersimpan!"); }
        };
        function bacaDataJumat() {
            const q = query(collection(db, "jadwal_jumat"), orderBy("tanggal", "asc"));
            onSnapshot(q, (s) => {
                let html = ""; s.forEach((docSnap) => {
                    const d = docSnap.data(), id = docSnap.id, tgl = new Date(d.tanggal).toLocaleDateString('id-ID', { day: 'numeric', month: 'short' });
                    const cell = (role, nama, status) => {
                        if (status === 'confirmed') return `<div class="bg-sukses status-badge mb-1">Sudah Bertugas <i class="bi bi-check-circle"></i></div><div class="fw-bold">${nama}</div>`;
                        else return `<div class="bg-pending status-badge mb-1">Rencana</div><div class="fw-bold mb-2">${nama}</div><div class="d-flex gap-1 justify-content-center"><button onclick="konfirmasi('${id}', '${role}', '${nama}')" class="btn btn-primary btn-konfirmasi">OK</button><button onclick="bukaModalGanti('${id}', '${role}', '${nama}')" class="btn btn-warning btn-konfirmasi">Ganti</button></div>`;
                    };
                    html += `<tr><td class="text-center fw-bold">${tgl}</td><td class="text-center">${cell('khotib', d.khotib, d.status_khotib)}</td><td class="text-center">${cell('bilal', d.bilal, d.status_bilal)}</td><td class="text-center">${cell('muadzin', d.muadzin, d.status_muadzin)}</td><td class="text-center no-print"><button onclick="hapusData('jadwal_jumat','${id}')" class="btn btn-sm btn-outline-danger"><i class="bi bi-trash"></i></button></td></tr>`;
                });
                document.getElementById('tabel-jumat').innerHTML = html;
            });
        }
        window.konfirmasi = async (id, role, nama) => { if(!confirm(`Konfirmasi ${nama} hadir?`)) return; let up = {}; up[`status_${role}`] = 'confirmed'; await updateDoc(doc(db, "jadwal_jumat", id), up); await putarAntrianKeBelakang(role, nama); };
        window.bukaModalGanti = (id, role, namaLama) => { document.getElementById('ganti_id_jadwal').value = id; document.getElementById('ganti_role').value = role; document.getElementById('nama_lama_display').innerText = namaLama; const list = masterDataCache[role] || []; let optHtml = ""; list.forEach(nama => { if(nama !== namaLama) optHtml += `<option value="${nama}">${nama}</option>`; }); document.getElementById('pilih_pengganti').innerHTML = optHtml; modalGantiBootstrap.show(); };
        window.prosesGanti = async () => { const id = document.getElementById('ganti_id_jadwal').value, role = document.getElementById('ganti_role').value, namaBaru = document.getElementById('pilih_pengganti').value; if(!namaBaru) return alert("Pilih pengganti!"); let up = {}; up[role] = namaBaru; up[`status_${role}`] = 'confirmed'; await updateDoc(doc(db, "jadwal_jumat", id), up); await putarAntrianKeBelakang(role, namaBaru); modalGantiBootstrap.hide(); };
        async function putarAntrianKeBelakang(role, nama) { const ref = doc(db, "master_data", role); await updateDoc(ref, { list: arrayRemove(nama) }); await updateDoc(ref, { list: arrayUnion(nama) }); }
        
        window.tambahMaster = async(t) => { let v=document.getElementById(`new_${t}`).value.toUpperCase(); if(v) await updateDoc(doc(db,"master_data",t),{list:arrayUnion(v)}); document.getElementById(`new_${t}`).value=''; };
        window.hapusMasterNama = async(t,n) => { if(confirm("Hapus?")) await updateDoc(doc(db,"master_data",t),{list:arrayRemove(n)}); };
        window.hapusData = async (c,i) => { if(confirm("Hapus?")) await deleteDoc(doc(db,c,i)); };
    </script>
</body>
</html>
